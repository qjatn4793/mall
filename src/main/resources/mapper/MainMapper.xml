<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shopping.mall.main.mapper.MainMapper">
    <resultMap id="mainResultMap" type="com.shopping.mall.main.vo.MainVo">
        <id property="mainSeq" column="main_seq"/>
        <result property="mainTitle" column="main_title"/>
        <result property="mainRegDate" column="main_regDate"/>
        <result property="mainViews" column="main_views"/>
        <result property="mainContents" column="main_contents"/>
        <result property="thumbContents" column="thumb_contents"/>
    </resultMap>

    <select id="getMainList" resultMap="mainResultMap">
      SELECT * FROM main_contents
      LIMIT #{startIndex}, #{pageSize}
    </select>

    <select id="getTotalCount" resultType="int">
      SELECT COUNT(*) FROM main_contents
    </select>

    <select id="getMainDetail" parameterType="int" resultMap="mainResultMap">
      SELECT * FROM main_contents
      WHERE main_seq = #{mainSeq}
    </select>

    <update id="updateViews" parameterType="int">
      UPDATE main_contents SET main_views = main_views + 1 WHERE main_seq = #{mainSeq}
    </update>

    <select id="getMainPreview" parameterType="int" resultMap="mainResultMap">
        <![CDATA[
        SELECT * FROM (
        SELECT *, 1 as sort_order
        FROM main_contents
        WHERE main_seq > (SELECT main_seq FROM main_contents WHERE main_seq = #{mainSeq})
        UNION ALL
        SELECT *, 2 as sort_order
        FROM main_contents
        WHERE main_seq <= (SELECT main_seq FROM main_contents WHERE main_seq = #{mainSeq})
        ) AS preview
        ORDER BY sort_order, main_seq ASC
        LIMIT 8
        ]]>
    </select>

</mapper>
